<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Cursos - Universidad Central</title>
    <link rel="stylesheet" href="/Proyecto/CSS/estilos.css" />

    <!-- Supabase -->
    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js";

      const supabaseUrl = "https://nczlzsxuzadgtskeclxx.supabase.co";
      const supabaseKey ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5jemx6c3h1emFkZ3Rza2VjbHh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5OTc1NTAsImV4cCI6MjA3OTU3MzU1MH0.VknukOGF5w_iX-J7KR_zLzEBo_PGVvNl1XOqRkAtHpU";

      const supabase = createClient(supabaseUrl, supabaseKey);

      // --------------------------
      // Cargar cursos
      // --------------------------
      async function cargarCursos() {
        const tabla = document.getElementById("tabla-cursos");
        tabla.innerHTML = "";

        const { data, error } = await supabase.from("cursos").select("*");

        if (error) {
          console.error(error);
          return;
        }

        data.forEach((curso) => {
          tabla.innerHTML += `
            <tr>
              <td>${curso.codigo}</td>
              <td>${curso.nombre}</td>
              <td>${curso.creditos}</td>
              <td>${curso.profesor}</td>
              <td><button onclick="eliminarCurso(${curso.id})">Eliminar</button></td>
            </tr>
          `;
        });
      }

      // --------------------------
      // Agregar curso
      // --------------------------
      window.agregarCurso = async function () {
        const codigo = document.getElementById("codigo").value;
        const nombre = document.getElementById("nombre").value;
        const creditos = document.getElementById("creditos").value;
        const profesor = document.getElementById("profesor").value;

        const { error } = await supabase.from("cursos").insert([
          { codigo, nombre, creditos, profesor },
        ]);

        if (error) {
          alert("Error al agregar el curso");
          console.log(error);
          return;
        }

        alert("Curso agregado");
        cargarCursos();
      };

      // --------------------------
      // Eliminar curso
      // --------------------------
      window.eliminarCurso = async function (id) {
        const { error } = await supabase.from("cursos").delete().eq("id", id);

        if (error) {
          alert("Error al eliminar");
          return;
        }

        alert("Curso eliminado");
        cargarCursos();
      };

      window.onload = cargarCursos;
    </script>
  </head>

  <body>
    <header>
      <h1>Módulo de Cursos</h1>
    </header>

    <nav>
      <a href="index.html">Inicio</a>
      <a href="estudiantes.html">Estudiantes</a>
      <a href="cursos.html">Cursos</a>
      <a href="profesores.html">Profesores</a>
    </nav>

    <main>
      <section>
        <h2>Agregar Curso</h2>

        <form onsubmit="event.preventDefault(); agregarCurso();">
          <label>Código:</label>
          <input type="text" id="codigo" required />

          <label>Nombre del Curso:</label>
          <input type="text" id="nombre" required />

          <label>Créditos:</label>
          <input type="number" id="creditos" min="1" required />

          <label>Profesor:</label>
          <input type="text" id="profesor" required />

          <button type="submit">Agregar</button>
        </form>
      </section>

      <section>
        <h2>Listado de Cursos</h2>

        <table>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Créditos</th>
            <th>Profesor</th>
            <th>Acciones</th>
          </tr>

          <tbody id="tabla-cursos"></tbody>
        </table>
      </section>
    </main>

    <footer>
      <p>&copy; 2025 Universidad Central</p>
    </footer>
  </body>
</html>
